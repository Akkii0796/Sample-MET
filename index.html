<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weekly Food Schedule</title>
    <style>
      body {
        font-family: sans-serif;
        margin: 0;
        padding: 1rem;
        background: #fdfdfd;
      }
      h1, h2 {
        color: #333;
      }
      .section {
        margin-bottom: 2rem;
        border-bottom: 1px solid #ddd;
        padding-bottom: 1rem;
      }
      .recipe-form input,
      .recipe-form textarea,
      .planner select {
        margin: 0.3rem;
        padding: 0.5rem;
      }
      table {
        width: 100%;
        border-collapse: collapse;
      }
      th, td {
        padding: 0.5rem;
        border: 1px solid #ccc;
        text-align: center;
      }
      .today {
        background: #ffe;
        padding: 1rem;
        border-radius: 8px;
        margin-bottom: 1rem;
      }
      .tag {
        font-size: 0.85rem;
        background: #eef;
        margin: 2px;
        padding: 2px 5px;
        border-radius: 4px;
      }
    </style>
  </head>
  <body>
    <h1>üç¥ Weekly Food Schedule</h1>

    <div class="section today" id="todayView"></div>

    <div class="section" id="weeklyPlanner"></div>

    <div class="section" id="masterList"></div>

    <div class="section" id="shoppingList"></div>

    <script>
      const DAYS = ["Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday"];
      const MEALS = ["Breakfast", "Lunch", "Dinner"];

      const defaultRecipes = [
        { id: 1, name: "Poha", category: "Breakfast", tags: ["quick", "veg"], notes: "Flattened rice, onion, lemon" },
        { id: 2, name: "Paneer Curry", category: "Lunch", tags: ["protein", "veg"], notes: "Paneer, tomato, spices" },
        { id: 3, name: "Dal Rice", category: "Dinner", tags: ["veg"], notes: "Toor dal, rice, ghee" },
      ];

      function loadRecipes() {
        return JSON.parse(localStorage.getItem("recipes")) || defaultRecipes;
      }

      function saveRecipes(data) {
        localStorage.setItem("recipes", JSON.stringify(data));
      }

      function loadPlan() {
        return JSON.parse(localStorage.getItem("mealPlan")) || {};
      }

      function savePlan(plan) {
        localStorage.setItem("mealPlan", JSON.stringify(plan));
      }

      function renderToday() {
        const today = new Date().getDay();
        const plan = loadPlan();
        const recipes = loadRecipes();
        const todayMeals = plan[DAYS[today]] || {};

        const view = document.getElementById("todayView");
        view.innerHTML = `<h2>Today's Meals - ${DAYS[today]}</h2>` +
          MEALS.map(meal => {
            const recipe = recipes.find(r => r.id == todayMeals[meal]);
            return `<p><strong>${meal}:</strong> ${recipe ? recipe.name : "-"}</p>`;
          }).join("");
      }

      function renderPlanner() {
        const plan = loadPlan();
        const recipes = loadRecipes();

        const container = document.getElementById("weeklyPlanner");
        let html = `<h2>üìÖ Weekly Planner</h2><table><thead><tr><th>Day</th>`;
        MEALS.forEach(meal => html += `<th>${meal}</th>`);
        html += `</tr></thead><tbody>`;

        DAYS.forEach(day => {
          html += `<tr><td>${day}</td>`;
          MEALS.forEach(meal => {
            html += `<td><select data-day="${day}" data-meal="${meal}">`;
            html += `<option value="">--Select--</option>`;
            recipes.filter(r => r.category === meal).forEach(r => {
              const selected = plan[day]?.[meal] == r.id ? "selected" : "";
              html += `<option value="${r.id}" ${selected}>${r.name}</option>`;
            });
            html += `</select></td>`;
          });
          html += `</tr>`;
        });
        html += `</tbody></table>`;
        container.innerHTML = html;

        container.querySelectorAll("select").forEach(select => {
          select.onchange = e => {
            const day = e.target.dataset.day;
            const meal = e.target.dataset.meal;
            const val = parseInt(e.target.value);
            if (!plan[day]) plan[day] = {};
            plan[day][meal] = val;
            savePlan(plan);
            renderToday();
            renderShopping();
          };
        });
      }

      function renderMaster() {
        const recipes = loadRecipes();
        const container = document.getElementById("masterList");

        let html = `<h2>üìñ Master Recipes</h2>`;
        html += `<form class="recipe-form" onsubmit="return false;">
          <input type="text" id="name" placeholder="Name" required>
          <select id="category">${MEALS.map(m => `<option>${m}</option>`)}</select>
          <input type="text" id="tags" placeholder="Tags (comma separated)">
          <textarea id="notes" placeholder="Notes"></textarea>
          <button type="submit">Add</button>
        </form>`;

        html += `<ul>` + recipes.map(r =>
          `<li><strong>${r.name}</strong> (${r.category}) - ${r.notes}<br>
            ${r.tags.map(tag => `<span class='tag'>${tag}</span>`).join(" ")}</li>`
        ).join("") + `</ul>`;

        container.innerHTML = html;

        container.querySelector("form").onsubmit = () => {
          const newRecipe = {
            id: Date.now(),
            name: document.getElementById("name").value,
            category: document.getElementById("category").value,
            tags: document.getElementById("tags").value.split(",").map(t => t.trim()).filter(Boolean),
            notes: document.getElementById("notes").value,
          };
          recipes.push(newRecipe);
          saveRecipes(recipes);
          renderMaster();
          renderPlanner();
        };
      }

      function renderShopping() {
        const container = document.getElementById("shoppingList");
        const plan = loadPlan();
        const recipes = loadRecipes();
        const used = new Set();
        const ingredients = new Set();

        Object.values(plan).forEach(day => {
          Object.values(day).forEach(id => used.add(id));
        });

        used.forEach(id => {
          const r = recipes.find(r => r.id == id);
          if (r?.notes) r.notes.split(",").forEach(i => ingredients.add(i.trim()));
        });

        container.innerHTML = `<h2>üõí Shopping List</h2>` +
          `<ul>${[...ingredients].map(i => `<li>${i}</li>`).join("")}</ul>`;
      }

      renderToday();
      renderPlanner();
      renderMaster();
      renderShopping();
    </script>
  </body>
</html>
