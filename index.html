<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Expense Tracker</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      set,
      get,
      onValue
    } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCVcdGryuTGeMS2Aq9C2cqbeNmfnddDIu8",
      authDomain: "monthly-expense-tracker-179de.firebaseapp.com",
      databaseURL:
        "https://monthly-expense-tracker-179de-default-rtdb.firebaseio.com",
      projectId: "monthly-expense-tracker-179de",
      storageBucket: "monthly-expense-tracker-179de.firebasestorage.app",
      messagingSenderId: "927646586236",
      appId: "1:927646586236:web:fc56a0334a31464cf000f9",
      measurementId: "G-CVR339GKH9"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let budget = 0;
    let expenses = [];
    const userKey = "shared_user";

    window.onload = function () {
      loadData();
      updateHeaderMonth();
    };

    async function loadData() {
      const snapshot = await get(ref(db, `users/${userKey}`));
      if (snapshot.exists()) {
        const data = snapshot.val();
        budget = data.budget || 0;
        expenses = data.expenses || [];
      }
      document.getElementById("budgetAmount").value = budget;
      updateDisplay();
    }

    function saveData() {
      set(ref(db, `users/${userKey}`), {
        budget: budget,
        expenses: expenses
      });
    }

    function updateHeaderMonth() {
      const date = new Date();
      const monthName = date.toLocaleDateString("en-US", { month: "long" });
      document.getElementById("headerTitle").innerHTML = `ðŸ’° Expense Tracker - ${monthName}`;
    }

    function setBudget() {
      const budgetInput = document.getElementById("budgetAmount");
      const newBudget = parseFloat(budgetInput.value);
      if (!newBudget || newBudget <= 0) {
        alert("Please enter a valid budget amount");
        return;
      }
      budget = newBudget;
      saveData();
      updateDisplay();
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = "âœ… Budget Set!";
      btn.style.background = "linear-gradient(135deg, #10b981, #059669)";
      setTimeout(() => {
        btn.textContent = originalText;
        btn.style.background = "linear-gradient(135deg, #4f46e5, #7c3aed)";
      }, 2000);
    }

    function addExpense() {
      const category = document.getElementById("category").value;
      const vendor = document.getElementById("vendor").value;
      const amount = parseFloat(document.getElementById("amount").value);
      const note = document.getElementById("note").value;
      if (!vendor.trim()) {
        alert("Please enter a vendor name");
        return;
      }
      if (!amount || amount <= 0) {
        alert("Please enter a valid amount");
        return;
      }
      const expense = {
        id: Date.now(),
        date: new Date().toISOString().split("T")[0],
        time: new Date().toLocaleTimeString(),
        category: category,
        vendor: vendor.trim(),
        amount: amount,
        note: note.trim()
      };
      expenses.push(expense);
      saveData();
      updateDisplay();
      document.getElementById("vendor").value = "";
      document.getElementById("amount").value = "";
      document.getElementById("note").value = "";
      const btn = event.target;
      const originalText = btn.textContent;
      btn.textContent = "âœ… Added!";
      setTimeout(() => {
        btn.textContent = originalText;
      }, 2000);
    }

    function deleteExpense(id) {
      if (confirm("Are you sure you want to delete this expense?")) {
        expenses = expenses.filter((expense) => expense.id !== id);
        saveData();
        updateDisplay();
      }
    }

    // Reuse your original updateDisplay, updateTopCategories, updateTopVendors, etc.
    // You can paste the entire JS logic and HTML as-is from your original code here
  </script>
  <style>
    /* Paste your full original CSS styles here */
  </style>
</head>
<body>
  <!-- Paste your original full HTML body content here, unchanged -->
</body>
</html>
