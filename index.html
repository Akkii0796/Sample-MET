<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Expense Tracker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh; padding: 10px;
    }
    .container {
      max-width: 1200px; margin: 0 auto;
      background: rgba(255,255,255,0.95); border-radius: 20px;
      backdrop-filter: blur(10px); box-shadow: 0 20px 40px rgba(0,0,0,0.1);
      overflow: hidden; animation: slideUp 0.5s ease-out;
    }
    @keyframes slideUp {
      from { opacity: 0; transform: translateY(30px); }
      to   { opacity: 1; transform: translateY(0); }
    }
    .header {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: white; padding: 20px; text-align: center;
    }
    .header h1 {
      font-size: 2rem; margin-bottom: 10px;
      text-shadow: 0 2px 4px rgba(0,0,0,0.3);
    }
    .main-content {
      display: grid; grid-template-columns: 1fr; gap: 20px; padding: 20px;
    }
    @media (min-width: 768px) {
      .main-content { grid-template-columns: 1fr 1fr; }
    }
    @media (min-width: 1024px) {
      .main-content { grid-template-columns: 1fr 1fr 1fr; }
    }
    .card {
      background: white; border-radius: 15px; padding: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.08);
      border: 1px solid rgba(0,0,0,0.05);
      transition: all 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 35px rgba(0,0,0,0.15);
    }
    .card h2 {
      color: #4f46e5; margin-bottom: 15px; font-size: 1.3rem;
      display: flex; align-items: center; gap: 10px;
    }
    .input-group { margin-bottom: 15px; }
    .input-group label {
      display: block; margin-bottom: 5px; color: #374151;
      font-weight: 600; font-size: 0.9rem;
    }
    .input-group input,
    .input-group select,
    .input-group textarea {
      width: 100%; padding: 12px 15px; border: 2px solid #e5e7eb;
      border-radius: 10px; font-size: 1rem; transition: all 0.3s ease;
      background: #f9fafb;
    }
    .input-group input:focus,
    .input-group select:focus,
    .input-group textarea:focus {
      outline: none; border-color: #4f46e5; background: white;
      box-shadow: 0 0 0 3px rgba(79,70,229,0.1);
    }
    .btn {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: white; border: none; padding: 12px 24px;
      border-radius: 10px; font-size: 1rem; font-weight: 600;
      cursor: pointer; transition: all 0.3s ease; width: 100%;
      margin-top: 10px;
    }
    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 10px 20px rgba(79,70,229,0.3);
    }
    .btn:active { transform: translateY(0); }
    .btn-secondary {
      background: linear-gradient(135deg, #10b981, #059669);
    }
    .btn-danger {
      background: linear-gradient(135deg, #ef4444, #dc2626);
      padding: 8px 16px; font-size: 0.9rem; width: auto; margin: 0;
    }
    .budget-summary {
      display: grid; grid-template-columns: 1fr; gap: 15px; margin-top: 15px;
    }
    @media (min-width: 480px) {
      .budget-summary { grid-template-columns: repeat(3,1fr); }
    }
    .budget-item {
      text-align: center; padding: 15px; border-radius: 10px;
      background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
    }
    .budget-item.budget {
      background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    }
    .budget-item.spent {
      background: linear-gradient(135deg, #fee2e2, #fecaca);
    }
    .budget-item.remaining {
      background: linear-gradient(135deg, #d1fae5, #a7f3d0);
    }
    .budget-item h3 {
      font-size: 0.9rem; color: #6b7280; margin-bottom: 5px;
    }
    .budget-item .amount {
      font-size: 1.5rem; font-weight: bold; color: #1f2937;
    }
    .table-container {
      overflow-x: auto; margin-top: 15px; border-radius: 10px;
      border: 1px solid #e5e7eb;
    }
    table {
      width: 100%; border-collapse: collapse; font-size: 0.9rem;
    }
    th {
      background: linear-gradient(135deg, #4f46e5, #7c3aed);
      color: white; padding: 12px 8px; text-align: left; font-weight: 600;
    }
    td {
      padding: 12px 8px; border-bottom: 1px solid #e5e7eb;
    }
    tr:hover { background: #f9fafb; }
    .stats-grid {
      display: grid; grid-template-columns: 1fr; gap: 20px;
      grid-column: 1/-1;
    }
    @media (min-width: 768px) {
      .stats-grid { grid-template-columns: 1fr 1fr; }
    }
    .icon { font-size: 1.2rem; }
    .full-width { grid-column: 1/-1; }
    .download-buttons {
      display: flex; gap: 10px; flex-wrap: wrap;
    }
    .download-buttons .btn {
      flex: 1; min-width: 120px;
    }
    @media (max-width: 480px) {
      .header h1 { font-size: 1.5rem; }
      .main-content { padding: 15px; gap: 15px; }
      .card { padding: 15px; }
      table { font-size: 0.8rem; }
      th, td { padding: 8px 4px; }
    }
    .expense-item {
      display: flex; justify-content: space-between; align-items: center;
      padding: 10px 0; border-bottom: 1px solid #e5e7eb;
    }
    .expense-item:last-child { border-bottom: none; }
    .expense-details { flex-grow: 1; }
    .expense-category {
      font-weight: 600; color: #4f46e5;
    }
    .expense-vendor {
      color: #6b7280; font-size: 0.9rem;
    }
    .expense-amount {
      font-weight: bold; color: #1f2937; margin-right: 10px;
    }
    .loading {
      display: inline-block; width: 20px; height: 20px;
      border: 3px solid #f3f3f3; border-top: 3px solid #3498db;
      border-radius: 50%; animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); }
    }
  </style>

  <!-- Firebase CDN setup & RTDB integration -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-app.js";
    import { getAnalytics }  from "https://www.gstatic.com/firebasejs/11.9.0/firebase-analytics.js";
    import {
      getDatabase, ref, set, onValue, remove
    } from "https://www.gstatic.com/firebasejs/11.9.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCVcdGryuTGeMS2Aq9C2cqbeNmfnddDIu8",
      authDomain: "monthly-expense-tracker-179de.firebaseapp.com",
      databaseURL: "https://monthly-expense-tracker-179de-default-rtdb.firebaseio.com",
      projectId: "monthly-expense-tracker-179de",
      storageBucket: "monthly-expense-tracker-179de.firebasestorage.app",
      messagingSenderId: "927646586236",
      appId: "1:927646586236:web:fc56a0334a31464cf000f9",
      measurementId: "G-CVR339GKH9"
    };

    // Initialize
    const app = initializeApp(firebaseConfig);
    getAnalytics(app);
    const db = getDatabase(app);

    let budget = 0, expenses = [];

    function loadData() {
      onValue(ref(db, 'budget'), snap => {
        const b = snap.val();
        if (b !== null) {
          budget = b;
          document.getElementById('budgetAmount').value = budget;
        }
        updateDisplay();
      });
      onValue(ref(db, 'expenses'), snap => {
        const d = snap.val();
        expenses = d ? Object.values(d) : [];
        updateDisplay();
      });
    }

    function setBudget() {
      const val = parseFloat(document.getElementById('budgetAmount').value);
      if (!val || val <= 0) return alert('Please enter a valid budget amount');
      budget = val;
      set(ref(db, 'budget'), budget);
      const btn = event.target, t = btn.textContent;
      btn.textContent = '✅ Budget Set!';
      btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
      setTimeout(()=>{
        btn.textContent = t;
        btn.style.background = '';
      },2000);
    }

    function addExpense() {
      const cat = document.getElementById('category').value;
      const vendor = document.getElementById('vendor').value.trim();
      const amt = parseFloat(document.getElementById('amount').value);
      const note = document.getElementById('note').value.trim();
      if (!vendor) return alert('Please enter a vendor name');
      if (!amt || amt <= 0) return alert('Please enter a valid amount');
      const id = Date.now();
      const e = {
        id,
        date: new Date().toISOString().split('T')[0],
        time: new Date().toLocaleTimeString(),
        category: cat,
        vendor,
        amount: amt,
        note
      };
      set(ref(db, `expenses/${id}`), e);
      const btn = event.target, t = btn.textContent;
      btn.textContent = '✅ Added!';
      setTimeout(()=> btn.textContent = t, 2000);
    }

    function deleteExpense(id) {
      if (confirm('Are you sure you want to delete this expense?')) {
        remove(ref(db, `expenses/${id}`));
      }
    }

    // UI updates (same logic as before)…
    function updateDisplay() {
      updateBudgetSummary();
      updateRecentExpenses();
      updateTopCategories();
      updateTopVendors();
      updateWeeklySummary();
      updateMonthlySummary();
    }
    function updateHeaderMonth() {
      const m = new Date().toLocaleDateString('en-US',{month:'long'});
      document.getElementById('headerTitle').textContent = `💰 Expense Tracker - ${m}`;
    }
    function updateBudgetSummary() {
      const total = expenses.reduce((s,e)=>s+e.amount,0);
      document.getElementById('budgetDisplay').textContent  = `₹${budget.toLocaleString()}`;
      document.getElementById('totalSpent').textContent    = `₹${total.toLocaleString()}`;
      document.getElementById('remaining').textContent     = `₹${(budget-total).toLocaleString()}`;
    }
    function updateRecentExpenses() {
      const c = document.getElementById('recentExpenses');
      if (!expenses.length) {
        c.innerHTML = `<p style="text-align:center;color:#6b7280;padding:20px">
                         No expenses added yet
                       </p>`;
        return;
      }
      c.innerHTML = expenses.slice(-5).reverse().map(e=>`
        <div class="expense-item">
          <div class="expense-details">
            <div class="expense-category">${e.category}</div>
            <div class="expense-vendor">
              ${new Date(e.date).toLocaleDateString('en-US',{
                day:'numeric',month:'short',year:'numeric'})}
              ${e.time}
            </div>
            ${e.note?`<div style="font-size:.8rem;color:#6b7280;margin-top:4px">
                        ${e.note}
                      </div>`:''}
          </div>
          <div style="display:flex;align-items:center;gap:10px">
            <div class="expense-amount">₹${e.amount.toLocaleString()}</div>
            <button class="btn btn-danger" onclick="deleteExpense(${e.id})">
              🗑️
            </button>
          </div>
        </div>`).join('');
    }
    function updateTopCategories() {
      const totals = expenses.reduce((a,e)=>(a[e.category]=(a[e.category]||0)+e.amount,a),{});
      const total = expenses.reduce((s,e)=>s+e.amount,0);
      const top    = Object.entries(totals).sort(([,a],[,b])=>b-a).slice(0,3);
      const tbody  = document.querySelector('#topCategoriesTable tbody');
      if (!top.length) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:#6b7280">
                              No data available
                            </td></tr>`;
        return;
      }
      tbody.innerHTML = top.map(([cat,amt],i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${cat}</td>
          <td>₹${amt.toLocaleString()}</td>
          <td>${((amt/total)*100).toFixed(1)}%</td>
        </tr>`).join('');
    }
    function updateTopVendors() {
      const totals = expenses.reduce((a,e)=>(a[e.vendor]=(a[e.vendor]||0)+e.amount,a),{});
      const total  = expenses.reduce((s,e)=>s+e.amount,0);
      const top     = Object.entries(totals).sort(([,a],[,b])=>b-a).slice(0,3);
      const tbody  = document.querySelector('#topVendorsTable tbody');
      if (!top.length) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:#6b7280">
                              No data available
                            </td></tr>`;
        return;
      }
      tbody.innerHTML = top.map(([v,amt],i)=>`
        <tr>
          <td>${i+1}</td>
          <td>${v}</td>
          <td>₹${amt.toLocaleString()}</td>
          <td>${((amt/total)*100).toFixed(1)}%</td>
        </tr>`).join('');
    }
    function updateWeeklySummary() {
      const w = {};
      expenses.forEach(e => {
        const d = new Date(e.date),
              s = new Date(d);
        s.setDate(d.getDate()-d.getDay());
        s.setHours(0,0,0,0);
        const key = s.toISOString().split('T')[0];
        w[key] = (w[key]||0) + e.amount;
      });
      const rows = Object.entries(w).sort(([a],[b])=>new Date(b)-new Date(a));
      const tbody = document.querySelector('#weeklySummaryTable tbody');
      if (!rows.length) {
        tbody.innerHTML = `<tr><td colspan="3" style="text-align:center;color:#6b7280">
                              No data available
                            </td></tr>`;
        return;
      }
      tbody.innerHTML = rows.map(([start,total],i)=>{
        const s=new Date(start), e=new Date(s);
        e.setDate(s.getDate()+6);
        return `
          <tr>
            <td>Week ${i+1}</td>
            <td>
              ${s.toLocaleDateString('en-US',{day:'numeric',month:'short',year:'numeric'})}
              -
              ${e.toLocaleDateString('en-US',{day:'numeric',month:'short',year:'numeric'})}
            </td>
            <td>₹${total.toLocaleString()}</td>
          </tr>`;
      }).join('');
    }
    function updateMonthlySummary() {
      const m = {};
      expenses.forEach(e => {
        const d = new Date(e.date),
              key = `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}`;
        if (!m[key]) m[key]={total:0,cats:{}};
        m[key].total += e.amount;
        m[key].cats[e.category] = (m[key].cats[e.category]||0) + e.amount;
      });
      const rows = Object.entries(m).sort(([,a],[,b])=>b.total-a.total);
      const tbody = document.querySelector('#monthlySummaryTable tbody');
      if (!rows.length) {
        tbody.innerHTML = `<tr><td colspan="4" style="text-align:center;color:#6b7280">
                              No data available
                            </td></tr>`;
        return;
      }
      tbody.innerHTML = rows.map(([month,data])=>{
        const topCat = Object.entries(data.cats)
                              .sort(([,a],[,b])=>b-a)[0] || ['N/A',0];
        return `
          <tr>
            <td>${new Date(month+'-01').toLocaleDateString('en-US',{
              year:'numeric',month:'long'})}</td>
            <td>₹${data.total.toLocaleString()}</td>
            <td>${topCat[0]}</td>
            <td>${topCat[1]?
                ((topCat[1]/data.total)*100).toFixed(1)+'%':'0%'}</td>
          </tr>`;
      }).join('');
    }

    window.onload = () => {
      loadData();
      updateHeaderMonth();
    };
  </script>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1 id="headerTitle">💰 Expense Tracker</h1>
      <p>Track your expenses and manage your budget efficiently</p>
    </div>
    <div class="main-content">
      <div class="card">
        <h2><span class="icon">🎯</span> Set Monthly Budget</h2>
        <div class="input-group">
          <label for="budgetAmount">Budget Amount (₹)</label>
          <input type="number" id="budgetAmount" placeholder="Enter your monthly budget">
        </div>
        <button class="btn" onclick="setBudget()">Set Budget</button>
        <div class="budget-summary">
          <div class="budget-item budget">
            <h3>Budget</h3>
            <div class="amount" id="budgetDisplay">₹0</div>
          </div>
          <div class="budget-item spent">
            <h3>Total Spent</h3>
            <div class="amount" id="totalSpent">₹0</div>
          </div>
          <div class="budget-item remaining">
            <h3>Remaining</h3>
            <div class="amount" id="remaining">₹0</div>
          </div>
        </div>
      </div>
      <div class="card">
        <h2><span class="icon">➕</span> Add Expense</h2>
        <div class="input-group">
          <label for="category">Category</label>
          <select id="category">
            <option>Grocery</option><option>Bills</option><option>Online shopping</option>
            <option>Travelling</option><option>Food</option><option>Medical expenses</option>
            <option>Debt</option><option>Petrol</option>
            <option>Home expenses other than grocery</option>
            <option>Maintenance</option><option>EMI</option><option>Investment</option>
            <option>Entertainment</option><option>Others</option>
          </select>
        </div>
        <div class="input-group">
          <label for="vendor">Vendor</label>
          <input type="text" id="vendor" placeholder="Enter vendor name">
        </div>
        <div class="input-group">
          <label for="amount">Amount (₹)</label>
          <input type="number" id="amount" placeholder="Enter amount">
        </div>
        <div class="input-group">
          <label for="note">Note</label>
          <textarea id="note" rows="3" placeholder="Add a note (optional)"></textarea>
        </div>
        <button class="btn btn-secondary" onclick="addExpense()">Add Expense</button>
      </div>
      <div class="card full-width">
        <h2><span class="icon">📋</span> Recent Expenses</h2>
        <div id="recentExpenses">
          <p style="text-align:center;color:#6b7280;padding:20px">
            No expenses added yet
          </p>
        </div>
      </div>
      <div class="stats-grid">
        <div class="card">
          <h2><span class="icon">🏆</span> Top 3 Categories</h2>
          <div class="table-container">
            <table id="topCategoriesTable">
              <thead>
                <tr><th>Rank</th><th>Category</th><th>Amount</th><th>%</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="4" style="text-align:center;color:#6b7280">
                    No data available
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="card">
          <h2><span class="icon">🛍️</span> Top 3 Vendors</h2>
          <div class="table-container">
            <table id="topVendorsTable">
              <thead>
                <tr><th>Rank</th><th>Vendor</th><th>Amount</th><th>%</th></tr>
              </thead>
              <tbody>
                <tr>
                  <td colspan="4" style="text-align:center;color:#6b7280">
                    No data available
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div class="card">
        <h2><span class="icon">📊</span> Weekly Summary</h2>
        <div class="table-container">
          <table id="weeklySummaryTable">
            <thead>
              <tr><th>Week</th><th>Period</th><th>Total Spent</th></tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="3" style="text-align:center;color:#6b7280">
                  No data available
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card">
        <h2><span class="icon">📈</span> Monthly Summary</h2>
        <div class="table-container">
          <table id="monthlySummaryTable">
            <thead>
              <tr><th>Month</th><th>Total Spent</th><th>Top Category</th><th>%</th></tr>
            </thead>
            <tbody>
              <tr>
                <td colspan="4" style="text-align:center;color:#6b7280">
                  No data available
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="card full-width">
        <h2><span class="icon">💾</span> Export Data</h2>
        <div class="download-buttons">
          <button class="btn" onclick="downloadCSV()">📄 Download CSV</button>
          <button class="btn" onclick="downloadPDF()">📊 Download PDF</button>
        </div>
      </div>
    </div>
  </div>

  <script>
    // CSV & PDF exports remain unchanged from your original code
    function downloadCSV() {
      if (!expenses.length) return alert('No expenses to export');
      const rows = [
        ['Date','Time','Category','Vendor','Amount','Note'],
        ...expenses.map(e => [e.date,e.time,e.category,e.vendor,e.amount,e.note||''])
      ];
      const csv = rows.map(r => r.map(f=>`"${f}"`).join(',')).join('\n');
      const blob = new Blob([csv],{ type:'text/csv' });
      const link = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = link;
      a.download = `expenses_${new Date().toISOString().split('T')[0]}.csv`;
      a.click();
      URL.revokeObjectURL(link);
    }
    function downloadPDF() {
      if (!expenses.length) return alert('No expenses to export');
      let content = `
        EXPENSE REPORT
        Generated: ${new Date().toLocaleDateString()}

        Budget: ₹${budget.toLocaleString()}
        Total Spent: ₹${expenses.reduce((s,e)=>s+e.amount,0).toLocaleString()}
        Remaining: ₹${(budget - expenses.reduce((s,e)=>s+e.amount,0)).toLocaleString()}

        EXPENSES:
      `;
      content += expenses.map(e =>
        `${new Date(e.date).toLocaleDateString('en-US',{day:'numeric',month:'short',year:'numeric'})}
         ${e.time} - ${e.category} - ${e.vendor} - ₹${e.amount}${e.note ? ' ('+e.note+')' : ''}`
      ).join('\n');
      const blob = new Blob([content],{ type:'text/plain' });
      const link = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = link;
      a.download = `expense_report_${new Date().toISOString().split('T')[0]}.txt`;
      a.click();
      URL.revokeObjectURL(link);
    }
  </script>
</body>
</html>
